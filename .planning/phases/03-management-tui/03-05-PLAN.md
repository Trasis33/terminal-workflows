---
phase: 03-management-tui
plan: 05
type: execute
wave: 4
depends_on: ["03-02", "03-03", "03-04"]
files_modified:
  - cmd/wf/manage.go
  - cmd/wf/root.go
  - internal/manage/model.go
autonomous: false

must_haves:
  truths:
    - "User can run `wf manage` and see the full-screen management TUI"
    - "User can create a workflow from the TUI and find it with `wf list`"
    - "User can edit a workflow from the TUI and see changes persisted"
    - "User can delete a workflow from the TUI with confirmation"
    - "User can browse by folder and filter by tag"
    - "User can change theme and see it persist across sessions"
    - "`wf manage` works alongside existing commands (pick, add, edit, rm, list)"
  artifacts:
    - path: "cmd/wf/manage.go"
      provides: "Cobra command wiring for `wf manage`"
      contains: "var manageCmd"
      min_lines: 15
  key_links:
    - from: "cmd/wf/manage.go"
      to: "internal/manage/manage.go"
      via: "Cobra command calls manage.Run()"
      pattern: "manage\\.Run"
    - from: "cmd/wf/root.go"
      to: "cmd/wf/manage.go"
      via: "rootCmd.AddCommand(manageCmd)"
      pattern: "manageCmd"
---

<objective>
Wire the management TUI into the CLI via `wf manage` cobra command, fix any integration issues, and verify the complete end-to-end flow.

Purpose: This is the final integration step that makes the management TUI accessible to users. All components built in Plans 01-04 come together here.
Output: Working `wf manage` command that launches the full-screen TUI with all features functional.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-management-tui/03-01-SUMMARY.md
@.planning/phases/03-management-tui/03-02-SUMMARY.md
@.planning/phases/03-management-tui/03-03-SUMMARY.md
@.planning/phases/03-management-tui/03-04-SUMMARY.md

@cmd/wf/root.go
@cmd/wf/pick.go
@internal/manage/manage.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cobra command + integration fixes</name>
  <files>
    cmd/wf/manage.go
    cmd/wf/root.go
    internal/manage/model.go
  </files>
  <action>
**cmd/wf/manage.go:**
```go
var manageCmd = &cobra.Command{
    Use:   "manage",
    Short: "Launch full-screen workflow manager",
    Long:  "Open an interactive TUI for creating, editing, deleting, and browsing workflows organized by folders and tags.",
    RunE:  runManage,
}

func runManage(cmd *cobra.Command, args []string) error {
    s := getStore()
    return manage.Run(s)
}
```

**cmd/wf/root.go:**
- Add `rootCmd.AddCommand(manageCmd)` to `init()` function
- Add import for `"github.com/fredriklanga/wf/internal/manage"`

**Integration verification — fix any issues found:**
- Run `go build ./cmd/wf/...` and fix any compilation errors
- Run `go vet ./...` and fix any issues
- Run `go test ./...` and fix any test failures
- Test the binary manually: `./wf manage` should launch full-screen TUI
- Verify quit works: "q" or "ctrl+c" exits cleanly back to terminal
- Verify alt-screen: terminal content restored after quit (no artifact)
- If any view transitions crash (nil pointer, missing init), fix in model.go

**Common integration issues to check:**
1. Import cycle: manage imports store, cmd imports both — should be fine since manage only imports store interface
2. Form initialization: huh form needs Init() called when transitioning to create/edit
3. WindowSizeMsg on first render: verify all views receive initial dimensions
4. Browse model initialization: ensure workflows are loaded before browse renders
  </action>
  <verify>
`go build ./cmd/wf/...` produces binary.
`./wf manage --help` shows command help.
`./wf --help` lists manage in available commands.
`go test ./...` — all tests pass.
  </verify>
  <done>
`wf manage` cobra command registered, binary compiles, help text visible, all existing commands still work.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end TUI verification</name>
  <what-built>Complete management TUI with browse, create, edit, delete, folder management, and theme settings — all accessible via `wf manage`</what-built>
  <how-to-verify>
1. Run `./wf manage` — verify full-screen TUI launches showing workflow list
2. Press "n" — verify create form appears with name, description, command, tags, folder fields
3. Fill in a test workflow (name: "test-manage", command: "echo hello {{name}}", description: "test from TUI", tags: "test,tui") — press submit
4. Verify you return to browse view and the new workflow appears in the list
5. Select the new workflow, press "e" — verify edit form opens with pre-populated fields
6. Change the description, save — verify change persists
7. Press "d" on a workflow — verify delete confirmation dialog appears as overlay
8. Confirm deletion — verify workflow removed from list
9. Press "tab" — verify sidebar toggles between folders and tags
10. Press "/" — verify search input appears, type to fuzzy filter
11. Press "ctrl+t" — verify settings view opens with theme fields
12. Select a different preset theme — verify colors change live
13. Press "q" — verify clean exit back to terminal
14. Run `./wf list` — verify workflows created/edited/deleted in TUI are reflected
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `wf manage` launches without errors
2. Full CRUD cycle works: create → edit → delete from within TUI
3. Folder browsing and tag filtering work in sidebar
4. Fuzzy search filters workflows correctly
5. Theme settings apply and persist
6. All existing commands unaffected: `wf add`, `wf edit`, `wf rm`, `wf list`, `wf pick`
7. Clean exit: alt-screen restored, no terminal artifacts
</verification>

<success_criteria>
- `wf manage` is a registered cobra subcommand
- Full-screen TUI launches in alt-screen mode
- Complete CRUD workflow: create, read (browse), update (edit), delete — all within TUI
- Folder and tag browsing functional
- Fuzzy search works
- Theme customization applies and persists
- All Phase 1 and Phase 2 commands still work correctly
- Clean terminal exit
</success_criteria>

<output>
After completion, create `.planning/phases/03-management-tui/03-05-SUMMARY.md`
</output>
